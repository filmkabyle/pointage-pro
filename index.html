<!DOCTYPE html>
<!-- The lang attribute will be changed dynamically -->
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#007aff"/>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgPprCWU972pY69r6BK7dsaLAwRPSi_0AfSeFHQVwK8zZNj3mJmGEi6uNARys9D7ygnVEye2OQU2wFA75aWnGJwusrzxFJ-CyVMqUvXchNQxGodf5MviBMOSaRovigoIGasMo8dC_CFEquxZVOVfozliKWgO2Z2GQdK0w09vH9HMjbN17bmZ7iVf5MzbcqW/s192/1000163283.jpg">
  
  <title data-translate-key="pageTitle">نظام حضور العمال السحابي</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="#" data-translate-key="brandTitle">حضور العمال</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="mainNavbar">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="#" id="navHome" data-translate-key="navHome">الرئيسية</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="navWorkers" data-translate-key="navWorkers">قائمة العمال</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="navLeaveRequests" data-translate-key="navLeaveRequests">طلبات الإجازة</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="navSettings" data-translate-key="navSettings">الإعدادات</a></li>
        </ul>
        <div class="dropdown me-3">
            <button class="btn btn-ios-outline dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-globe"></i> <span data-translate-key="language">اللغة</span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                <li><a class="dropdown-item" href="#" onclick="setLanguage('ar')">العربية</a></li>
                <li><a class="dropdown-item" href="#" onclick="setLanguage('en')">English</a></li>
                <li><a class="dropdown-item" href="#" onclick="setLanguage('fr')">Français</a></li>
            </ul>
        </div>
        <span id="userEmail" class="text-dark me-3"></span>
        <button id="logoutBtn" class="btn btn-ios hidden"><i class="fas fa-sign-out-alt"></i> <span data-translate-key="logoutBtn">تسجيل الخروج</span></button>
      </div>
    </div>
  </nav>
  
  <!-- Main Content -->
  <div class="container my-4">
    <!-- Auth Sections -->
    <div id="loginSection" class="text-center">
      <div class="card">
        <div class="card-body">
          <h3 data-translate-key="loginTitle">تسجيل الدخول</h3>
          <p class="text-muted" data-translate-key="loginSubtitle">أدخل بريدك الإلكتروني وكلمة المرور لتسجيل الدخول.</p>
          <input type="email" id="emailInput" class="form-control mb-2" data-translate-key="emailPlaceholder" placeholder="البريد الإلكتروني" required>
          <input type="password" id="passwordInput" class="form-control mb-2" data-translate-key="passwordPlaceholder" placeholder="كلمة المرور" required>
          <button id="loginBtnAuth" class="btn btn-ios mb-2 w-100" data-translate-key="loginBtn">تسجيل الدخول</button>
          <button id="gotoSignupBtn" class="btn btn-ios-outline mb-2 w-100" data-translate-key="createAccountBtn">إنشاء حساب</button>
          <p id="authErrorMsg" class="text-danger mt-2"></p>
        </div>
      </div>
    </div>
    <div id="signupSection" class="text-center hidden">
        <div class="card">
            <div class="card-body">
              <h3 data-translate-key="signupTitle">إنشاء حساب جديد</h3>
              <p class="text-muted" data-translate-key="signupSubtitle">أدخل اسم المستخدم، الإيميل، وكلمة المرور.</p>
              <input type="email" id="signupEmailInput" class="form-control mb-2" data-translate-key="emailPlaceholder" placeholder="البريد الإلكتروني" required>
              <input type="password" id="signupPasswordInput" class="form-control mb-2" data-translate-key="passwordPlaceholder" placeholder="كلمة المرور" required>
              <button id="signupBtn" class="btn btn-ios mb-2 w-100" data-translate-key="createAccountBtn">إنشاء الحساب</button>
              <button id="backToLoginBtn" class="btn btn-ios-outline mb-2 w-100" data-translate-key="backToLoginBtn">عودة لتسجيل الدخول</button>
              <p id="signupErrorMsg" class="text-danger mt-2"></p>
            </div>
          </div>
    </div>

    <!-- App Section -->
    <div id="appSection" class="hidden">
      <!-- Add Worker Section (Home) -->
      <div id="homeSection" class="card">
        <div class="card-header bg-transparent border-0"><h4 data-translate-key="addWorkerHeader">إضافة عامل جديد</h4></div>
        <div class="card-body">
          <form id="addWorkerForm">
            <div class="mb-3"><label for="workerNameInput" class="form-label" data-translate-key="workerNameLabel">اسم العامل</label><input type="text" class="form-control" id="workerNameInput" data-translate-key="workerNamePlaceholder" placeholder="أدخل اسم العامل" required></div>
            <button type="submit" class="btn btn-ios w-100"><i class="fas fa-user-plus"></i> <span data-translate-key="addWorkerBtn">إضافة عامل</span></button>
          </form>
        </div>
      </div>

      <!-- Workers List Section -->
      <div id="workersListSection" class="card hidden">
        <div class="card-header bg-transparent border-0"><h4 data-translate-key="workerListHeader">قائمة العمال</h4></div>
        <div class="card-body">
          <input type="text" id="searchInput" data-translate-key="searchPlaceholder" placeholder="ابحث عن عامل..." class="form-control mb-3" />
          <div id="workersListSkeleton"><div class="skeleton-item"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div><div class="skeleton-item"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div><div class="skeleton-item"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div></div>
          <ul id="workersList" class="list-group list-group-flush"></ul>
        </div>
      </div>

      <!-- Edit Worker Section -->
      <div id="editWorkerSection" class="card hidden">
          <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center"><h4 data-translate-key="editWorkerHeader">تعديل ملف العامل</h4><button id="backFromEditWorkerBtn" class="btn btn-ios-outline btn-sm"><i class="fas fa-arrow-left"></i> <span data-translate-key="backBtn">العودة</span></button></div>
          <div class="card-body">
            <form id="editWorkerForm"><input type="hidden" id="editWorkerId"><div class="mb-3"><label for="editWorkerName" class="form-label" data-translate-key="workerNameLabel">اسم العامل</label><input type="text" class="form-control" id="editWorkerName" required></div><div class="mb-3"><label for="editWorkerProfession" class="form-label" data-translate-key="professionLabel">المهنة</label><input type="text" class="form-control" id="editWorkerProfession"></div><div class="row"><div class="col-md-6 mb-3"><label for="editWorkerHourlyRate" class="form-label" data-translate-key="hourlyRateLabel">الأجر بالساعة</label><input type="number" step="0.01" min="0" class="form-control" id="editWorkerHourlyRate" placeholder="0.00"></div><div class="col-md-6 mb-3"><label for="editWorkerOvertimeRate" class="form-label" data-translate-key="overtimeRateLabel">أجر الساعة الإضافية</label><input type="number" step="0.01" min="0" class="form-control" id="editWorkerOvertimeRate" placeholder="0.00"></div></div><button type="submit" class="btn btn-record w-100 mb-2" data-translate-key="saveChangesBtn">حفظ التعديلات</button><button type="button" id="deleteWorkerBtn" class="btn btn-delete w-100"><i class="fas fa-trash"></i> <span data-translate-key="deleteWorkerBtn">حذف العامل</span></button></form>
          </div>
      </div>

      <!-- Worker Detail Section -->
      <div id="workerDetailSection" class="card hidden">
        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center flex-wrap"><h4 id="workerDetailName" class="mb-2"></h4><div class="btn-group"><button id="editWorkerBtn" class="btn btn-ios-outline btn-sm"><i class="fas fa-edit"></i> <span data-translate-key="editFileBtn">تعديل</span></button><button id="addRecordBtn" class="btn btn-new btn-sm"><i class="fas fa-plus"></i> <span data-translate-key="newRecordBtn">سجل جديد</span></button></div></div>
        <div class="card-body"><ul class="nav nav-tabs" id="detailTab" role="tablist"><li class="nav-item" role="presentation"><button class="nav-link active" id="records-tab" data-bs-toggle="tab" data-bs-target="#recordsTab" type="button" role="tab" data-translate-key="recordsTab">السجلات</button></li><li class="nav-item" role="presentation"><button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#statsTab" type="button" role="tab" data-translate-key="statsTab">التقارير</button></li></ul><div class="tab-content mt-3"><div class="tab-pane fade show active" id="recordsTab" role="tabpanel"><div class="table-responsive"><table class="table" id="recordsTable"><thead><tr><th data-translate-key="recordsTableHeaderDate">التاريخ</th><th data-translate-key="recordsTableHeaderType">النوع</th><th data-translate-key="recordsTableHeaderArrival">الحضور</th><th data-translate-key="recordsTableHeaderDeparture">الانصراف</th><th data-translate-key="recordsTableHeaderOvertime">إضافي</th><th data-translate-key="recordsTableHeaderLocation">الموقع</th><th data-translate-key="recordsTableHeaderActions">إجراءات</th></tr></thead><tbody id="recordsTableBody"></tbody></table></div></div><div class="tab-pane fade" id="statsTab" role="tabpanel"><div class="card mb-3"><div class="card-body"><h5 data-translate-key="filterByDate">فلترة حسب التاريخ</h5><div class="row g-2 align-items-center"><div class="col-md-5"><input type="date" id="startDateFilter" class="form-control"></div><div class="col-md-5"><input type="date" id="endDateFilter" class="form-control"></div><div class="col-md-2"><button id="applyFilterBtn" class="btn btn-ios w-100" data-translate-key="applyBtn">تطبيق</button></div></div><div class="d-flex gap-2 mt-3 flex-wrap"><button id="exportCsvBtn" class="btn btn-sm btn-export-csv"><i class="fas fa-file-csv"></i> <span data-translate-key="exportCsvBtn">تصدير CSV</span></button><button id="exportPdfBtn" class="btn btn-sm btn-export-pdf"><i class="fas fa-file-pdf"></i> <span data-translate-key="exportPdfBtn">تصدير PDF</span></button></div></div></div><div id="statisticsContainer" class="card"><div class="card-body"><p data-translate-key="loadingStats">جاري تحميل الإحصائيات...</p></div></div></div></div></div>
        <div class="card-footer bg-transparent border-0"><button id="backToWorkersList" class="btn btn-ios-outline w-100"><i class="fas fa-arrow-left"></i> <span data-translate-key="backToWorkerListBtn">العودة لقائمة العمال</span></button></div>
      </div>
      
      <!-- Add/Edit Record Section -->
      <div id="recordSection" class="card hidden">
        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center"><h4 id="recordFormTitle" data-translate-key="addRecordTitle">إضافة سجل حضور</h4><button id="backFromRecordBtn" class="btn btn-ios-outline btn-sm"><i class="fas fa-arrow-left"></i> <span data-translate-key="backBtn">العودة</span></button></div>
        <div class="card-body"><form id="recordForm"><input type="hidden" id="recordId" value=""><div class="mb-3"><label for="recordDate" class="form-label" data-translate-key="recordDateLabel">التاريخ</label><input type="date" class="form-control" id="recordDate" required></div><div class="mb-3"><label for="recordType" class="form-label" data-translate-key="recordTypeLabel">نوع السجل</label><select class="form-select" id="recordType" required><option value="حضور" data-translate-key="recordTypeAttendance">حضور</option><option value="غياب" data-translate-key="recordTypeAbsence">غياب</option></select></div><div id="timeFields"><div class="mb-3"><label for="arrivalTime" class="form-label" data-translate-key="arrivalTimeLabel">وقت الحضور</label><input type="time" class="form-control" id="arrivalTime"></div><div class="mb-3"><label for="departureTime" class="form-label" data-translate-key="departureTimeLabel">وقت الانصراف</label><input type="time" class="form-control" id="departureTime"></div></div><div class="mb-3"><label for="overtime" class="form-label" data-translate-key="overtimeLabel">الساعات الإضافية</label><input type="number" step="0.1" min="0" class="form-control" id="overtime" placeholder="0"></div><button type="submit" class="btn btn-record w-100" data-translate-key="saveRecordBtn">حفظ السجل</button></form></div>
      </div>

      <!-- Leave Management Section -->
      <div id="leaveManagementSection" class="card hidden">
        <div class="card-header bg-transparent border-0"><h4 data-translate-key="leaveManagementHeader">إدارة طلبات الإجازة</h4></div>
        <div class="card-body"><h5 data-translate-key="newLeaveRequestTitle">تقديم طلب إجازة جديد</h5><form id="leaveRequestForm" class="mb-4"><div class="row g-3"><div class="col-md-4"><label for="leaveWorkerSelect" class="form-label" data-translate-key="workerLabel">العامل</label><select id="leaveWorkerSelect" class="form-select" required><option value="" data-translate-key="selectWorkerOption">اختر عاملاً...</option></select></div><div class="col-md-3"><label for="leaveStartDate" class="form-label" data-translate-key="startDateLabel">تاريخ البدء</label><input type="date" id="leaveStartDate" class="form-control" required></div><div class="col-md-3"><label for="leaveEndDate" class="form-label" data-translate-key="endDateLabel">تاريخ الانتهاء</label><input type="date" id="leaveEndDate" class="form-control" required></div><div class="col-md-2 d-flex align-items-end"><button type="submit" class="btn btn-ios w-100" data-translate-key="submitRequestBtn">إرسال</button></div></div></form><hr><h5 class="mt-4" data-translate-key="leaveRequestsHistoryTitle">سجل طلبات الإجازة</h5><div class="table-responsive"><table class="table" id="leaveRequestsTable"><thead><tr><th data-translate-key="workerNameLabel">اسم العامل</th><th data-translate-key="startDateLabel">من تاريخ</th><th data-translate-key="endDateLabel">إلى تاريخ</th><th data-translate-key="statusLabel">الحالة</th><th data-translate-key="actionsLabel">إجراءات</th></tr></thead><tbody id="leaveRequestsTableBody"></tbody></table></div></div>
      </div>

      <!-- Settings Section -->
      <div id="settingsSection" class="card hidden">
        <div class="card-header bg-transparent border-0"><h4 data-translate-key="userSettingsHeader">إعدادات المستخدم</h4></div>
        <div class="card-body"><form id="settingsForm"><div class="mb-3"><label class="form-label" data-translate-key="currentModeLabel">المظهر</label><select class="form-select" id="themeSelect"><option value="light" data-translate-key="lightMode">فاتح</option><option value="dark" data-translate-key="darkMode">داكن</option></select></div><button type="button" id="saveSettingsBtn" class="btn btn-ios w-100" data-translate-key="saveSettingsBtn">حفظ الإعدادات</button></form></div>
      </div>
    </div>
  </div>
  
  <!-- JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Main App Script -->
  <script src="script.js"></script>
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('Service Worker registered successfully.'))
          .catch(err => console.error('Service Worker registration failed:', err));
      });
    }
  </script>
</body>
</html>
